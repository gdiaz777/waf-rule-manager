name: Run PowerShell Script

on:
  workflow_dispatch:  # manually trigger or change to your desired event

jobs:
  manage-waf-rules:
    name: manage WAF rules
    runs-on: ubuntu-latest

    env:
      WAF_API_KEY: ${{ secrets.WAFKEY }}
      WAF_API_KEY_SECRET: ${{ secrets.WAFSECRET }}

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
     
    # pwsh is already available in the ubuntu-latest image
    # - name: Install PowerShell
    #   run: |
    #     sudo apt-get update
    #     sudo apt-get install -y wget apt-transport-https software-properties-common
    #     wget -q "https://packages.microsoft.com/config/ubuntu/$(lsb_release -rs)/packages-microsoft-prod.deb"
    #     sudo dpkg -i packages-microsoft-prod.deb
    #     sudo apt-get update
    #     sudo apt-get install -y powershell

    - name: Run PowerShell script
      shell: pwsh
      run: |
        Write-Host "Running PowerShell script..."
        ./waf-rule-manager.ps1
